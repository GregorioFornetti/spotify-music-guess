var B=Object.defineProperty;var x=(e,t,n)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var h=(e,t,n)=>(x(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const w="https://gregoriofornetti.github.io/spotify-music-guess/dist";async function C(e){const t=S(128),n=await b(t);localStorage.setItem("verifier",t);const s=new URLSearchParams;s.append("client_id",e),s.append("response_type","code"),s.append("redirect_uri",w),s.append("scope","user-read-private user-read-email user-modify-playback-state"),s.append("code_challenge_method","S256"),s.append("code_challenge",n),document.location=`https://accounts.spotify.com/authorize?${s.toString()}`}async function M(e,t){const n=localStorage.getItem("verifier"),s=new URLSearchParams;s.append("client_id",e),s.append("grant_type","authorization_code"),s.append("code",t),s.append("redirect_uri",w),s.append("code_verifier",n);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),{access_token:r}=await o.json();return r}function S(e){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}async function b(e){const t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(n)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function a(e){var n;const t=(n=document.getElementById("main"))==null?void 0:n.children;if(t)for(let s=0;s<t.length;s++){const o=t[s];o.style.display="none",o.id===e&&(o.style.display="block")}}class u{static get accessToken(){return this._accessToken}static get accessTokenHeader(){return{Authorization:`Bearer ${this._accessToken}`}}static set accessToken(t){this._accessToken=t}}h(u,"_accessToken","");const E="b3c2339a149d46afa94a39347466b623",A=new URLSearchParams(window.location.search),k=A.get("code");document.addEventListener("DOMContentLoaded",async()=>{a(""),k?(u.accessToken=await M(E,k),a("playlist-selection-page")):C(E)});const y="([A-Za-z0-9]{22})",O=new RegExp(`^${y}$`),I=new RegExp(`^spotify:playlist:${y}$`),L=new RegExp(`^https://open.spotify.com/playlist/${y}(\\?si=.*)?$`);function P(e){return I.test(e)}function H(e){return L.test(e)}function N(e){return O.test(e)}function R(e){return e.match(I)[1]}function $(e){return e.match(L)[1]}function D(e){if(e=e.trim(),P(e))return R(e);if(H(e))return $(e);if(N(e))return e;throw new Error("URI, URL ou ID inválido.")}function g(e){const t=document.createElement("div");t.classList.add("music");const n=document.createElement("img");n.classList.add("music-image"),n.setAttribute("src",e.album.images[0].url);const s=document.createElement("p");s.classList.add("music-name"),s.innerText=e.name;const o=document.createElement("p");return o.classList.add("music-artist"),o.innerText=e.artists[0].name,t.appendChild(n),t.appendChild(s),t.appendChild(o),t}function G(e,t,n,s,o){o?document.getElementById("song-result-message").innerText="Você acertou !":document.getElementById("song-result-message").innerText="Você errou !",document.getElementById("song-result-current-round").innerText=e.toString(),document.getElementById("song-result-total-rounds").innerText=t.toString();const r=document.getElementById("song-result-correct-song");r.innerHTML="",r.appendChild(g(n));const m=document.getElementById("song-result-guessed-song");m.innerHTML="",m.appendChild(g(s)),a("song-result-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("song-result-next"))==null||e.addEventListener("click",()=>{v()})});function U(e,t){document.getElementById("final-result-correct-count").innerText=e.toString(),document.getElementById("final-result-total-rounds").innerText=t.toString(),a("final-result-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("final-result-return"))==null||e.addEventListener("click",()=>{a("playlist-selection-page")})});var c=null,p=null,d,i,T=null,l=1,f=0;function j(e,t){return t.filter(n=>n.track.name.toLowerCase().startsWith(e.toLowerCase()))}function z(e,t){return t.filter(n=>n.track.artists[0].name.toLowerCase().startsWith(e.toLowerCase()))}function F(e,t,n){return j(e,z(t,n))}async function V(e,t){await fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:u.accessTokenHeader,body:JSON.stringify({context_uri:`spotify:playlist:${T}`,headers:u.accessTokenHeader,position_ms:0,offset:{position:e}})}),setTimeout(()=>{fetch("https://api.spotify.com/v1/me/player/pause",{method:"PUT",headers:u.accessTokenHeader})},t*1e3)}function W(e,t){d=e,i=[...Array(d.tracks.items.length).keys()];for(let n=i.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[i[n],i[s]]=[i[s],i[n]]}c=null,p=null,T=t,l=0,f=0,document.getElementById("song-guess-submit").onclick=()=>{let n=p===d.tracks.items[i[l-1]].track.id;G(l,5,d.tracks.items[i[l-1]].track,d.tracks.items.filter(s=>s.track.id===p)[0].track,n),n&&(f+=1),p=null,c=null}}function v(){if(console.log("oi"),l>=5){U(f,5);return}const e=document.getElementById("song-guess-input"),t=document.getElementById("artist-guess-input");e.value="",t.value="",l+=1,_(d.tracks.items),V(i[l-1],5),a("song-guess-page")}function _(e){c=null;const t=document.getElementById("playlist-tracks-list-game");t.innerHTML="";for(let n of e){const s=g(n.track);s.classList.add("clickable"),s.addEventListener("click",()=>{c&&c.classList.remove("selected"),c=s,c.classList.add("selected"),p=n.track.id}),n.track.id===p&&(c=s,c.classList.add("selected")),t.appendChild(s)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("song-guess-input"),t=document.getElementById("artist-guess-input"),n=()=>{_(F(e.value,t.value,d.tracks.items))};e.addEventListener("input",n),t.addEventListener("input",n)});function q(e,t){document.getElementById("playlist-image").setAttribute("src",e.images[0].url),document.getElementById("playlist-name").innerText=e.name,e.description?document.getElementById("playlist-description").innerText=e.description:document.getElementById("playlist-description").innerText="Sem descrição",e.owner.display_name?document.getElementById("playlist-owner").innerText=e.owner.display_name:document.getElementById("playlist-owner").innerText="",document.getElementById("playlist-tracks-count").innerText=e.tracks.total;const n=document.getElementById("playlist-tracks-list");n.innerHTML="";for(let s of e.tracks.items)n.appendChild(g(s.track));document.getElementById("game-start").onclick=()=>{W(e,t),v()},a("playlist-info-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-return"))==null||e.addEventListener("click",()=>{a("playlist-selection-page")})});async function J(e){return fetch(`https://api.spotify.com/v1/playlists/${e}`,{method:"GET",headers:u.accessTokenHeader}).then(t=>t.json()).then(async t=>{for(var n=t.tracks.next;n;)await fetch(n,{method:"GET",headers:u.accessTokenHeader}).then(s=>s.json()).then(s=>{t.tracks.items.push(...s.items),n=s.next});return t})}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-form"))==null||e.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("playlist-input").value;try{const s=D(n),o=await J(s);q(o,s)}catch(s){console.log(s)}})});
