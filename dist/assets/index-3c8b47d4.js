var x=Object.defineProperty;var C=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var f=(e,t,n)=>(C(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const L="https://gregoriofornetti.github.io/spotify-music-guess/dist";async function b(e){const t=S(128),n=await A(t);localStorage.setItem("verifier",t);const s=new URLSearchParams;s.append("client_id",e),s.append("response_type","code"),s.append("redirect_uri",L),s.append("scope","user-read-private user-read-email user-modify-playback-state"),s.append("code_challenge_method","S256"),s.append("code_challenge",n),document.location=`https://accounts.spotify.com/authorize?${s.toString()}`}async function M(e,t){const n=localStorage.getItem("verifier"),s=new URLSearchParams;s.append("client_id",e),s.append("grant_type","authorization_code"),s.append("code",t),s.append("redirect_uri",L),s.append("code_verifier",n);const r=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),{access_token:o}=await r.json();return o}function S(e){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}async function A(e){const t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(n)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function l(e){var n;const t=(n=document.getElementById("main"))==null?void 0:n.children;if(t)for(let s=0;s<t.length;s++){const r=t[s];r.style.display="none",r.id===e&&(r.style.display="block")}}class i{static get accessToken(){return this._accessToken}static get accessTokenHeader(){return{Authorization:`Bearer ${this._accessToken}`}}static set accessToken(t){this._accessToken=t}static get country(){return this._country}static set country(t){this._country=t}}f(i,"_accessToken",""),f(i,"_country","");async function O(){return(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:i.accessTokenHeader}).then(t=>t.json())).country}const E="b3c2339a149d46afa94a39347466b623",P=new URLSearchParams(window.location.search),k=P.get("code");document.addEventListener("DOMContentLoaded",async()=>{l(""),k?(i.accessToken=await M(E,k),i.country=await O(),console.log(i.country),l("playlist-selection-page")):b(E)});const h="([A-Za-z0-9]{22})",H=new RegExp(`^${h}$`),T=new RegExp(`^spotify:playlist:${h}$`),I=new RegExp(`^https://open.spotify.com/playlist/${h}(\\?si=.*)?$`);function $(e){return T.test(e)}function R(e){return I.test(e)}function G(e){return H.test(e)}function N(e){return e.match(T)[1]}function U(e){return e.match(I)[1]}function D(e){if(e=e.trim(),$(e))return N(e);if(R(e))return U(e);if(G(e))return e;throw new Error("URI, URL ou ID inválido.")}function g(e){const t=document.createElement("div");t.classList.add("music");const n=document.createElement("img");n.classList.add("music-image"),e.type==="track"?e.album.images.length!==0&&n.setAttribute("src",e.album.images[0].url):e.type==="episode"&&e.images.length!==0&&n.setAttribute("src",e.images[0].url);const s=document.createElement("p");s.classList.add("music-name"),s.innerText=e.name;const r=document.createElement("p");return r.classList.add("music-artist"),e.type==="track"?r.innerText=e.artists[0].name:e.type==="episode"&&(r.innerText=e.show.name),t.appendChild(n),t.appendChild(s),t.appendChild(r),t}function j(e,t,n,s,r){r?document.getElementById("song-result-message").innerText="Você acertou !":document.getElementById("song-result-message").innerText="Você errou !",document.getElementById("song-result-current-round").innerText=e.toString(),document.getElementById("song-result-total-rounds").innerText=t.toString();const o=document.getElementById("song-result-correct-song");o.innerHTML="",o.appendChild(g(n));const m=document.getElementById("song-result-guessed-song");m.innerHTML="",m.appendChild(g(s)),l("song-result-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("song-result-next"))==null||e.addEventListener("click",()=>{v()})});function z(e,t){document.getElementById("final-result-correct-count").innerText=e.toString(),document.getElementById("final-result-total-rounds").innerText=t.toString(),l("final-result-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("final-result-return"))==null||e.addEventListener("click",()=>{l("playlist-selection-page")})});var a=null,p=null,d,c,_=null,u=1,y=0;function F(e,t){return t.filter(n=>n.track.name.toLowerCase().startsWith(e.toLowerCase()))}function V(e,t){return t.filter(n=>{if(n.track.type==="episode")return n.track.show.name.toLowerCase().startsWith(e.toLowerCase());if(n.track.type==="track")return n.track.artists[0].name.toLowerCase().startsWith(e.toLowerCase())})}function W(e,t,n){return F(e,V(t,n))}async function q(e,t){await fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:i.accessTokenHeader,body:JSON.stringify({context_uri:`spotify:playlist:${_}`,position_ms:0,offset:{position:e}})}),setTimeout(()=>{fetch("https://api.spotify.com/v1/me/player/pause",{method:"PUT",headers:i.accessTokenHeader})},t*1e3)}function J(e,t){d=e,c=[...Array(d.tracks.items.length).keys()];for(let n=c.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[c[n],c[s]]=[c[s],c[n]]}a=null,p=null,_=t,u=0,y=0,document.getElementById("song-guess-submit").onclick=()=>{let n=p===d.tracks.items[c[u-1]].track.id;j(u,5,d.tracks.items[c[u-1]].track,d.tracks.items.filter(s=>s.track.id===p)[0].track,n),n&&(y+=1),p=null,a=null}}function v(){if(u>=5){z(y,5);return}const e=document.getElementById("song-guess-input"),t=document.getElementById("artist-guess-input");e.value="",t.value="",u+=1,B(d.tracks.items),q(c[u-1],5),l("song-guess-page")}function B(e){a=null;const t=document.getElementById("playlist-tracks-list-game");t.innerHTML="";for(let n of e){const s=g(n.track);s.classList.add("clickable"),s.addEventListener("click",()=>{a&&a.classList.remove("selected"),a=s,a.classList.add("selected"),p=n.track.id}),n.track.id===p&&(a=s,a.classList.add("selected")),t.appendChild(s)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("song-guess-input"),t=document.getElementById("artist-guess-input"),n=()=>{B(W(e.value,t.value,d.tracks.items))};e.addEventListener("input",n),t.addEventListener("input",n)});function K(e,t){document.getElementById("playlist-image").setAttribute("src",e.images[0].url),document.getElementById("playlist-name").innerText=e.name,e.description?document.getElementById("playlist-description").innerText=e.description:document.getElementById("playlist-description").innerText="Sem descrição",e.owner.display_name?document.getElementById("playlist-owner").innerText=e.owner.display_name:document.getElementById("playlist-owner").innerText="",document.getElementById("playlist-tracks-count").innerText=e.tracks.total;const n=document.getElementById("playlist-tracks-list");n.innerHTML="";for(let s of e.tracks.items)n.appendChild(g(s.track));document.getElementById("game-start").onclick=()=>{J(e,t),v()},l("playlist-info-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-return"))==null||e.addEventListener("click",()=>{l("playlist-selection-page")})});const w=e=>e.track?e.track.is_playable:!1;async function Z(e){return fetch(`https://api.spotify.com/v1/playlists/${e}?market=${i.country}&additional_types=episode`,{method:"GET",headers:i.accessTokenHeader}).then(t=>t.json()).then(async t=>{console.log(t);var n=t.tracks.next;for(t.tracks.items=t.tracks.items.filter(w);n;)await fetch(n,{method:"GET",headers:i.accessTokenHeader}).then(s=>s.json()).then(s=>{t.tracks.items.push(...s.items.filter(w)),n=s.next});return t})}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-form"))==null||e.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("playlist-input").value;try{const s=D(n),r=await Z(s);K(r,s)}catch(s){console.log(s)}})});
