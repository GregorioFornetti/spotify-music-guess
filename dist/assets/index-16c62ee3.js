var w=Object.defineProperty;var v=(e,t,s)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var f=(e,t,s)=>(v(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();const h="https://gregoriofornetti.github.io/spotify-music-guess/dist";async function L(e){const t=x(128),s=await b(t);localStorage.setItem("verifier",t);const n=new URLSearchParams;n.append("client_id",e),n.append("response_type","code"),n.append("redirect_uri",h),n.append("scope","user-read-private user-read-email user-modify-playback-state"),n.append("code_challenge_method","S256"),n.append("code_challenge",s),document.location=`https://accounts.spotify.com/authorize?${n.toString()}`}async function I(e,t){const s=localStorage.getItem("verifier"),n=new URLSearchParams;n.append("client_id",e),n.append("grant_type","authorization_code"),n.append("code",t),n.append("redirect_uri",h),n.append("code_verifier",s);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}),{access_token:i}=await o.json();return i}function x(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}async function b(e){const t=new TextEncoder().encode(e),s=await window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(s)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function d(e){var s;const t=(s=document.getElementById("main"))==null?void 0:s.children;if(t)for(let n=0;n<t.length;n++){const o=t[n];o.style.display="none",o.id===e&&(o.style.display="block")}}class r{static get accessToken(){return this._accessToken}static get accessTokenHeader(){return{Authorization:`Bearer ${this._accessToken}`}}static set accessToken(t){this._accessToken=t}}f(r,"_accessToken","");const g="b3c2339a149d46afa94a39347466b623",S=new URLSearchParams(window.location.search),y=S.get("code");document.addEventListener("DOMContentLoaded",async()=>{d(""),y?(r.accessToken=await I(g,y),d("playlist-selection-page")):L(g)});const p="([A-Za-z0-9]{22})",B=new RegExp(`^${p}$`),E=new RegExp(`^spotify:playlist:${p}$`),_=new RegExp(`^https://open.spotify.com/playlist/${p}(\\?si=.*)?$`);function C(e){return E.test(e)}function M(e){return _.test(e)}function A(e){return B.test(e)}function O(e){return e.match(E)[1]}function P(e){return e.match(_)[1]}function $(e){if(e=e.trim(),C(e))return O(e);if(M(e))return P(e);if(A(e))return e;throw new Error("URI, URL ou ID inválido.")}function T(e){const t=document.createElement("div");t.classList.add("music");const s=document.createElement("img");s.classList.add("music-image"),s.setAttribute("src",e.album.images[0].url);const n=document.createElement("p");n.classList.add("music-name"),n.innerText=e.name;const o=document.createElement("p");return o.classList.add("music-artist"),o.innerText=e.artists[0].name,t.appendChild(s),t.appendChild(n),t.appendChild(o),t}var a=null,m=null,l,c,k=null;async function H(e,t){await fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:r.accessTokenHeader,body:JSON.stringify({context_uri:`spotify:playlist:${k}`,headers:r.accessTokenHeader,position_ms:0,offset:{position:e}})}),setTimeout(()=>{fetch("https://api.spotify.com/v1/me/player/pause",{method:"PUT",headers:r.accessTokenHeader})},t*1e3)}function R(e,t){l=e,c=[...Array(l.tracks.items.length).keys()];for(let s=c.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[c[s],c[n]]=[c[n],c[s]]}a=null,m=null,k=t}function U(e){const t=document.getElementById("playlist-tracks-list-game");t.innerHTML="";for(let s of l.tracks.items){const n=T(s.track);n.classList.add("clickable"),n.addEventListener("click",()=>{a&&a.classList.remove("selected"),a=n,a.classList.add("selected"),m=s.track.id}),t.appendChild(n)}H(c[e-1],5),d("song-guess-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("song-guess-submit"))==null||e.addEventListener("click",()=>{m===l.tracks.items[c[0]].track.id?alert("Você acertou!"):alert("Você errou!")})});function D(e,t){document.getElementById("playlist-image").setAttribute("src",e.images[0].url),document.getElementById("playlist-name").innerText=e.name,e.description?document.getElementById("playlist-description").innerText=e.description:document.getElementById("playlist-description").innerText="Sem descrição",e.owner.display_name?document.getElementById("playlist-owner").innerText=e.owner.display_name:document.getElementById("playlist-owner").innerText="",document.getElementById("playlist-tracks-count").innerText=e.tracks.total;const s=document.getElementById("playlist-tracks-list");s.innerHTML="";for(let n of e.tracks.items)s.appendChild(T(n.track));document.getElementById("game-start").onclick=()=>{R(e,t),U(1)},d("playlist-info-page")}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-return"))==null||e.addEventListener("click",()=>{d("playlist-selection-page")})});async function N(e){return fetch(`https://api.spotify.com/v1/playlists/${e}`,{method:"GET",headers:r.accessTokenHeader}).then(t=>t.json()).then(async t=>{for(var s=t.tracks.next;s;)await fetch(s,{method:"GET",headers:r.accessTokenHeader}).then(n=>n.json()).then(n=>{t.tracks.items.push(...n.items),s=n.next});return t})}document.addEventListener("DOMContentLoaded",()=>{var e;(e=document.getElementById("playlist-form"))==null||e.addEventListener("submit",async t=>{t.preventDefault();const s=document.getElementById("playlist-input").value;try{const n=$(s),o=await N(n);D(o,n)}catch(n){console.log(n)}})});
